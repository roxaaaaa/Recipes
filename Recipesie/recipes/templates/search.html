{% extends "base2.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Search Recipes</h2>

    <form method="get" action="{% url 'search' %}" class="form-inline mb-4">
        <select name="category" class="form-control mr-2">
            <option value="name" {% if category == 'name' %}selected{% endif %}>Recipe Name</option>
            <option value="ingredient" {% if category == 'ingredient' %}selected{% endif %}>Ingredient</option>
            <option value="tag" {% if category == 'tag' %}selected{% endif %}>Tag</option>
            <option value="contributor" {% if category == 'contributor' %}selected{% endif %}>Contributor</option>
            <option value="steps" {% if category == 'steps' %}selected{% endif %}>Max Steps (<=)</option>
            <option value="minutes" {% if category == 'minutes' %}selected{% endif %}>Max Minutes (<=)</option>
            <option value="num_ingredients" {% if category == 'num_ingredients' %}selected{% endif %}>Max Ingredients (<=)</option>
        </select>

        <input type="text" name="q" value="{{ query }}" placeholder="Search query..." class="form-control mr-2">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-danger">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <hr>

    {% if results %}
        <div class="list-group">
            {% for recipe in results %}
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">
                            {% if user.is_authenticated %}
                                <a href="{% url 'recipe_detail' %}?recipe_id={{ recipe.id }}">{{ recipe.name }}</a>
                            {% else %}
                                {{ recipe.name }}
                            {% endif %}
                        </h5>
                        <small class="text-muted">By: {{ recipe.contributor.username }}</small>
                    </div>

                    {% if recipe.recipe_img %}
                        <div class="my-2">
                            <img src="{{ recipe.recipe_img.url }}" alt="{{ recipe.name }}" style="max-width: 200px; display: block;">
                        </div>
                    {% endif %}

                    <p class="mb-1">Minutes: {{ recipe.minutes }} | Steps: {{ recipe.nsteps }}</p>

                    <a href="{% url 'recipe_detail' %}?recipe_id={{ recipe.id }}" class="btn btn-sm btn-info">View Details</a>

                    {% if user.is_authenticated %}
                        <a href="{% url 'edit_recipe' recipe.id %}" class="btn btn-sm btn-warning">Edit Recipe</a>

                        <a href="{% url 'update_recipe_image' recipe.id %}" class="btn btn-sm btn-primary">
                            {% if recipe.recipe_img %} Update Image {% else %} Add Image {% endif %}
                        </a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% elif query and not messages %}
        <p class="text-secondary">No recipes found.</p>
    {% endif %}
</div>
{% endblock %}